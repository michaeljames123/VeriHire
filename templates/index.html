<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Bootstrap 5.3.2 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="/static/style.css">

    <title>VeriHire - Real or Fake Job Prediction</title>
  </head>

  <body>
    <!-- Flash Messages Modal -->
    {% for message in get_flashed_messages() %}
    <div id="resultModal" class="modal fade" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg modal-horizontal">
        <div class="modal-content">
          <div class="modal-header border-0">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center py-4">
            {% if message=='FRAUDULENT JOB' %}
            <div class="result-content">
              <i class="bi bi-x-circle-fill text-danger mb-3" style="font-size: 4rem;"></i>
              <h4 class="text-danger fw-bold mb-2">{{message}}</h4>
              <p class="text-muted">This job posting appears to be fraudulent. Exercise caution.</p>
              <div class="text-start mt-3">
                <h6 class="text-primary fw-bold">Safety Tips</h6>
                <ul id="safetyTipList" class="list-unstyled small"></ul>

                <h6 class="text-primary fw-bold mt-3">Application Advice</h6>
                <ul id="adviceList" class="list-unstyled small"></ul>
              </div>
            </div>
                
            {% elif message == 'SUSPICIOUS' %}
            <div class="result-content">
                <i class="bi bi-exclamation-triangle-fill text-warning mb-3" style="font-size: 4rem;"></i>
                <h4 class="text-warning fw-bold mb-2">{{ message }}</h4>
                <p class="text-muted">This job posting seems suspicious. Check carefully before applying.</p>
                <div class="text-start mt-3">
                    <h6 class="text-primary fw-bold">Safety Tips</h6>
                    <ul id="safetyTipList" class="list-unstyled small"></ul>

                    <h6 class="text-primary fw-bold mt-3">Application Advice</h6>
                    <ul id="adviceList" class="list-unstyled small"></ul>
                </div>
            </div>

            {% elif message == "Input text is too short, repetitive, or not meaningful enough to analyze." %}
            <div class="result-content">
              <i class="bi bi-exclamation-triangle-fill text-warning mb-3" style="font-size: 4rem;"></i>
              <h4 class="text-warning fw-bold mb-2">{{ message }}</h4>
              <p class="text-muted">The submitted job details are insufficient for proper analysis.</p>
            </div>

            {% else %}
            <div class="result-content">
              <i class="bi bi-check-circle-fill text-success mb-3" style="font-size: 4rem;"></i>
              <h4 class="text-success fw-bold mb-2">{{message}}</h4>
              <p class="text-muted">This job posting appears to be legitimate.</p>

              {% if top_features %}
                <div class="mt-3 text-start">
                  <h6 class="fw-bold">Top Words Influencing Prediction:</h6>
                  <ul class="list-unstyled small">
                    {% for word, score in top_features %}
                      <li>{{ word }}: {{ score }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}

            </div>
            {% endif %}
          </div>
          <div class="modal-footer border-0 justify-content-center">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <div class="navbar-brand">
          <div class="brand-icon">
            <i class="bi bi-shield-check"></i>
          </div>
          <span class="brand-text">VeriHire</span>
        </div>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Background Elements -->
      <div class="bg-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
      </div>

      <div class="container">
        <div class="row align-items-start">
          <!-- Left Column - Content -->
          <div class="col-lg-6 order-1 order-lg-1">
            <div class="hero-content">
              <h1 class="hero-title">
                Welcome to<br>
                <span class="text-primary">VeriHire</span>
              </h1>
              <p class="hero-subtitle">
                Detect fraudulent job posts with our AI-powered verification system. 
                Protect yourself from fake job opportunities and scams.
              </p>

              <!-- Quick URL Analysis -->
              <div class="quick-analysis-card">
                <form action="{{ url_for('submit') }}" method="POST" enctype="multipart/form-data" class="url-form">
                  <div class="input-group">
                    <input
                      type="url"
                      class="form-control"
                      id="url"
                      name="url"
                      required
                      placeholder="Paste job posting URL here..."
                    />
                    <button type="submit" class="btn btn-primary">
                      Verify Now
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- Right Column - Manual Verification -->
          <div class="col-lg-6 order-2 order-lg-2">
            <!-- Manual Entry Form -->
            <div class="manual-entry-section mt-4">
              <h5 class="mb-3">
                <i class="bi bi-file-text text-primary me-2"></i>
                Manual Job Verification
              </h5>
              <form action="{{ url_for('submit') }}" method="POST" enctype="multipart/form-data" class="manual-form">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="title" class="form-label">Job Title</label>
                    <input type="text" class="form-control" id="title" name="title" placeholder="e.g., Software Engineer" required/>
                  </div>
                  
                  <div class="col-md-6">
                    <label for="location" class="form-label">Location</label>
                    <input type="text" class="form-control" id="location" name="location" placeholder="e.g., New York, NY" required/>
                  </div>

                  <div class="col-md-6">
                    <label for="salary" class="form-label">Salary</label>
                    <input type="text" class="form-control" id="salary" name="salary" placeholder="e.g., 1k - 50k" required/>
                  </div>

                  <div class="col-md-6">
                    <label for="department" class="form-label">Department</label>
                    <input type="text" class="form-control" id="department" name="department" placeholder="e.g., Engineering" required/>
                  </div>
                  
                  <div class="col-md-6">
                    <label for="benefits" class="form-label">Benefits</label>
                    <input type="text" class="form-control" id="benefits" name="ben" placeholder="e.g., Health insurance, 401k" required/>
                  </div>

                  <div class="col-md-6">
                    <label for="emptype" class="form-label">Employment Type</label>
                    <select name="emptype" required class="form-select">
                      <option value="" disabled selected>Select employment type</option>
                      <option value="Fulltime">Full-Time</option>
                      <option value="Part Time">Part-Time</option>
                      <option value="Contract">Contract</option>
                      <option value="Temporary">Temporary</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>

                  <div class="col-md-6">
                    <label for="exp" class="form-label">Required Experience</label>
                    <select name="exp" required class="form-select">
                      <option value="" disabled selected>Select experience level</option>
                      <option value="Internship">Internship</option>
                      <option value="Entry level">Entry Level</option>
                      <option value="Associate">Associate</option>
                      <option value="Mid-senior level">Mid-Senior Level</option>
                      <option value="Executive">Executive</option>
                      <option value="Director">Director</option>
                      <option value="Not applicable">Not Applicable</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  
                  <div class="col-md-6">
                    <label for="education" class="form-label">Required Education</label>
                    <input type="text" class="form-control" id="education" name="edu" placeholder="e.g., Bachelor's degree" required/>
                  </div>
                  
                  <div class="col-md-12">
                    <label for="industry" class="form-label">Industry</label>
                    <input type="text" class="form-control" id="industry" name="indu" placeholder="e.g., Technology" required/>
                  </div>
                  
                  <div class="col-12">
                    <label for="function" class="form-label">Job Function</label>
                    <input type="text" class="form-control" id="function" name="func" placeholder="e.g., Software Development" required/>
                  </div>
                  
                  <div class="col-12">
                    <label for="profile" class="form-label">Company Profile</label>
                    <textarea class="form-control" id="profile" name="profile" rows="3" placeholder="Brief description about the company..." required></textarea>
                  </div>
                  
                  <div class="col-12">
                    <label for="requirements" class="form-label">Requirements</label>
                    <textarea class="form-control" id="requirements" name="req" rows="3" placeholder="Job requirements and qualifications..." required></textarea>
                  </div>
                  
                  <div class="col-12">
                    <label for="description" class="form-label">Job Description</label>
                    <textarea class="form-control" id="description" name="des" rows="4" placeholder="Detailed job description..." required></textarea>
                  </div>

                  <div class="col-12">
                    <button type="submit" class="btn btn-primary">
                      <i class="bi bi-shield-check me-2"></i>
                      Analyze Job Posting
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('resultModal');
        if (modal) {
          const safetyTipList = modal.querySelector('#safetyTipList');
          const adviceList = modal.querySelector('#adviceList');

          const pickRandom = (arr, n=3) => {
            const copy = [...arr];
            const result = [];
            while (copy.length && result.length < n) {
              const idx = Math.floor(Math.random() * copy.length);
              result.push(copy.splice(idx, 1)[0]);
            }
            return result;
          };

          const safetyTips = [
            'Verify the company website and cross-check the job posting there.',
            'Use official channels for all communication—avoid personal emails.',
            'Never pay any fees for jobs, training, or equipment upfront.',
            'Research the recruiter on LinkedIn and confirm their affiliation.',
            'Schedule video calls and ask role-specific questions to validate legitimacy.',
            'Report suspicious postings to the platform and local authorities.',
          ];

          const advice = [
            'Share your resume only after the company confirms interview details.',
            'Ask for a formal offer on company letterhead before sharing documents.',
            'Confirm the job location, contract type, and compensation structure in writing.',
            'Use a separate email alias when testing questionable opportunities.',
            'Avoid clicking shortened or suspicious links—navigate directly to the site.',
          ];

          if (safetyTipList && adviceList) {
            const render = (ul, items) => {
              ul.innerHTML = '';
              items.forEach(text => {
                const li = document.createElement('li');
                li.className = 'd-flex align-items-start mb-1';
                li.innerHTML = `<span>${text}</span>`;
                ul.appendChild(li);
              });
            };
            render(safetyTipList, pickRandom(safetyTips, 3).map(t => t.replace(/^/, '• ')));
            render(adviceList, pickRandom(advice, 3).map(t => t.replace(/^/, '• ')));
          }

          const bootstrapModal = new bootstrap.Modal(modal);
          bootstrapModal.show();
        }

        // --- AUTO-FILL JOB DETAILS WHEN URL IS PASTED ---
        const urlInput = document.getElementById("url");
        if (urlInput) {
          urlInput.addEventListener("change", async function() {
            const jobUrl = urlInput.value.trim();
            if (!jobUrl) return;

            try {
              const res = await fetch("/scrape", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url: jobUrl })
              });

              const data = await res.json();
              if (data.error) {
                console.error("Scraping failed:", data.error);
                return;
              }

              // Map scraped data -> form fields
              document.getElementById("title").value = data["Job Title"] || "";
              document.getElementById("location").value = data["Location"] || "";
              document.getElementById("salary").value = data["Salary"] || "";
              document.getElementById("department").value = data["Department"] || "";
              document.getElementById("profile").value = data["Company Profile"] || "";
              document.getElementById("requirements").value = data["Requirements"] || "";
              document.getElementById("benefits").value = data["Benefits"] || "";
              document.querySelector("select[name='emptype']").value = data["Employment Type"] || "";
              document.querySelector("select[name='exp']").value = data["Required Experience"] || "";
              document.getElementById("education").value = data["Required Education"] || "";
              document.getElementById("industry").value = data["Industry"] || "";
              document.getElementById("function").value = data["Function"] || "";
              document.getElementById("description").value = data["Description"] || "";
            } catch (err) {
              console.error("Error fetching job data:", err);
            }
          });
        }
      });
    </script>
  </body>
</html>
